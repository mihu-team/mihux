{"version":3,"file":"index.js","sources":["../mihux/index.tsx"],"sourcesContent":["import React, { Fragment, useContext, useEffect, useMemo, useState } from 'react'\r\nimport createStore from 'react-hooks-redux'\r\nimport { Map, fromJS } from 'immutable'\r\n\r\ninterface registerType {\r\n  state: object\r\n  sync?: object\r\n  async?: object\r\n}\r\ninterface MapOrObjType {\r\n  [key: string]: any\r\n}\r\n\r\ninterface doReducerType {\r\n  type: string\r\n  reducer: (state: MapOrObjType) => MapOrObjType\r\n}\r\n\r\n\r\nconst Context: React.Context<any> = React.createContext({})\r\n\r\nconst useComponent: (Component: new (props: any) => any) => any = (Component) => {\r\n  return (props: any) => {\r\n    const component = useMemo(() => new Component(props), []);\r\n    let [state, setState] = useState(component.state);\r\n    component.setState = setState;\r\n    useEffect(() => {\r\n      if (component.componentWillMount) {\r\n        component.componentWillMount()\r\n      }\r\n\r\n      if (component.componentDidMount) {\r\n        component.props = props;\r\n        component.state = state;\r\n        component.componentDidMount()\r\n      }\r\n\r\n      return () => {\r\n        if (component.componentWillUnMount) {\r\n          component.componentWillUnMount()\r\n        }\r\n      }\r\n    }, [])\r\n\r\n    component.props = props;\r\n    component.state = state;\r\n    return component.render()\r\n  };\r\n}\r\n\r\nclass Mihux {\r\n  private state: MapOrObjType = {}\r\n  private returnMap: MapOrObjType = {}\r\n  private store: MapOrObjType = {}\r\n  private mutation: MapOrObjType = {}\r\n  private mapState: MapOrObjType = {}\r\n  private getNewState: () => MapOrObjType = () => {\r\n    let newState: MapOrObjType = Object.assign({}, this.store.getState())\r\n    let mapState: MapOrObjType = Map({ ...newState })\r\n    return mapState\r\n  }\r\n  private set: (key: string, value: any) => MapOrObjType = (key, value) => {\r\n    let mapState: MapOrObjType = this.getNewState()\r\n    return mapState.set(key, value)\r\n  }\r\n  private setIn: (keys: string[], value: any) => MapOrObjType = (keys, value) => {\r\n    let mapState: MapOrObjType = this.getNewState()\r\n    return mapState.setIn(keys, value)\r\n  }\r\n  private merge: (newSatet: MapOrObjType) => MapOrObjType = (values) => {\r\n    let mapState: MapOrObjType = this.getNewState()\r\n    return mapState.merge({ ...values })\r\n  }\r\n  private getValue: (state: MapOrObjType, key: string) => any = (state, key) => {\r\n    let values: any = state.get(key)\r\n    try {\r\n      return values.toJS()\r\n    } catch {\r\n      return values\r\n    }\r\n  }\r\n  private mapMutation: (fns: MapOrObjType, model: string, flag?: string) => void = (fns, model, flag) => {\r\n    const me: this = this\r\n    const createReducer: (key: string, mapNewState: MapOrObjType) => void = (key, mapNewState) => {\r\n      const doReducer: () => doReducerType = () => {\r\n        return {\r\n          type: key,\r\n          reducer(state: MapOrObjType) {\r\n            let mapState: any = fromJS(state)\r\n            me.returnMap = mapState?.merge(mapNewState)\r\n            return me.returnMap.toJS()\r\n          },\r\n        }\r\n      }\r\n      typeof this?.store?.dispatch === 'function' && this?.store?.dispatch(doReducer())\r\n      return me.returnMap\r\n    }\r\n    let builtIn: MapOrObjType = {\r\n      mutation: this.mutation[model],\r\n      setState: this.set,\r\n      setInState: this.setIn,\r\n      mergeState: this.merge,\r\n      getValue: this.getValue\r\n    }\r\n    Object.keys(fns).forEach((key) => {\r\n      switch (flag) {\r\n        case 'async':\r\n          let toUpperCaseKey: string = 'async' + key.replace(key[0], key[0].toUpperCase());\r\n          (this.mutation[model][toUpperCaseKey] = async (values: any) => {\r\n            return createReducer(toUpperCaseKey, await fns[key](this.returnMap, values, builtIn))\r\n          })\r\n          break;\r\n        default:\r\n          (this.mutation[model][key] = (values: any) => {\r\n            return createReducer(key, fns[key](this.returnMap, values, builtIn))\r\n          })\r\n      }\r\n    })\r\n  }\r\n  private init: () => { store: MapOrObjType; Provider: any } = () => {\r\n    const { Provider, store } = createStore({ initialState: { ...this.state } })\r\n    this.store = store\r\n    this.mapState = Map({ ...this.state })\r\n    this.returnMap = this.mapState\r\n    return { store, Provider }\r\n  }\r\n  public register: (registerProps: registerType) => void = (registerProps) => {\r\n    let { state = {}, sync = {}, async = {} } = registerProps\r\n    let model = '@__for_page__model__mihux__key__only_global__!_{0}_{0}_$_#!_'\r\n    this.mutation[model] = {}\r\n    this.mapMutation(sync, model)\r\n    this.mapMutation(async, model, 'async')\r\n    this.state = Object.assign({}, { ...state }, { ...this.mutation[model] })\r\n  }\r\n  public Provider: React.FC<any> = (props: any) => {\r\n    const { store, Provider } = this.init()\r\n    const newProps: { store: MapOrObjType } = { store }\r\n    const ProviderChildren: React.FC<any> = props => {\r\n      const { store } = useContext(Context)\r\n      const { children } = props\r\n      const state = store.useContext()\r\n      return (\r\n        <Context.Provider value={state}>\r\n          {children}\r\n        </Context.Provider>\r\n      )\r\n    }\r\n\r\n    return (\r\n      <Context.Provider value={newProps}>\r\n        <Provider>\r\n          <ProviderChildren {...props} />\r\n        </Provider>\r\n      </Context.Provider>\r\n    )\r\n  }\r\n}\r\n\r\nexport { Mihux, Context, useComponent }"],"names":[],"mappings":"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"}